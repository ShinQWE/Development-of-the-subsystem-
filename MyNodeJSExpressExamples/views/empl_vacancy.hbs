   <div id="header3">    {{> header3}}        </div>
    <link rel="stylesheet" href="css/resume.css" />
    <script src="js/Empl_script.js"></script>

    <div class='grid_out'>
        <div>
            <span class="Title" style="text-align:center" id="doc_title">Создание/редактирование вакансии</span>
            <article class="innerTitle_" style="color:navy; padding-left:25px;">
                <a href="javascript:f_back()" id="num_vac_left"> &#9668;</a>
                Вакансия <span id="id_vac_cur">{{VAC_NUM}}</span>  <a href="javascript:f_forward()" id="num_vac_right">  &#9658; </a>
            </article>   <br style="line-height:3px">
            <div style="overflow-x: hidden; overflow-y: auto; border: solid thin aliceblue; max-height: 70vh; width: 100%;">

                <div class="outer">
                    <a href="javascript:Empl_f1('frm1_1')" class="innerTitle">
                        <span id="frm1_1_" class="innerTitle_">▷</span>&nbsp;&nbsp; Сведения о вакансии и условиях работы
                    </a>  <br>
                    <form class="gr hide" id="frm1_1">
                        <div>Код (по Реестру Минтруда)</div>
                        <div>
                            <textarea rows="2" cols="40" name="Vac_Code" id="Vac_Code" value=" " onclick="GetVacValue('sel1_vac', 'Vac_Code')"></textarea>*
                            <br> <select id="sel1_vac" name="sel1_vac" class="opt1  hide" style="position:relative; left:0px">
                            </select>
                        </div>
                        <div>Должность</div>                                        <div> <input type="text" name="Vac_JobTitle" id="Vac_JobTitle" value="" /></div>
                        <div>Должностные обязанности</div>         <div><textarea rows="2" cols="40" name="Vac_JobResp" id="Vac_JobResp" value=""></textarea></div>

                        <div>Степень занятости</div>                                        <div>
                            <input type="text" name="Vac_JobType" id="Vac_JobType" value="" onclick="GetVacValue('sel2_vac', 'Vac_JobType')" />*
                            <br> <select id="sel2_vac" name="sel2_vac" class="opt1  hide" style="position:relative; left:0px">
                                <option value="Выбрать из списка" selected>Выбрать из списка</option>
                                <option value="Постоянная работа"> Постоянная</option>
                                <option value="Постоянная по совместительству"> Постоянная  по совместительству</option>
                                <option value="Временная работа"> Временная</option>
                            </select>
                        </div>
                        <div>График  работы</div>                                        <div>
                            <input type="text" name="Vac_Schedule" id="Vac_Schedule" value="" onclick="GetVacValue('sel3_vac', 'Vac_Schedule')" />*
                            <br> <select id="sel3_vac" name="sel3_vac" class="opt1  hide" style="position:relative; left:0px">
                                <option value="Выбрать из списка" selected>Выбрать из списка</option>
                                <option value="Нормальный график"> Нормальный график</option>
                                <option value="Скользящий график"> Скользящий график</option>
                                <option value="Сокращенный график">Сокращенный график</option>
                                <option value="Неполное рабочее время">Неполное рабочее время</option>
                                <option value="Ненормированный график">Ненормированный график</option>
                            </select>
                        </div>
                        <div>Зарплата </div>                                        <div>
                            <input type="text" name="Vac_Salary" id="Vac_Salary" value="" style="width:202px" onclick="GetVacValue('sel4_vac', 'Vac_Salary')" />
                            *&nbsp;    <input type="number" name="Vac_Salary_1" id="Vac_Salary_1" value="" style="width:90px" />
                            <br> <select id="sel4_vac" name="sel4_vac" class="opt1  hide" style="position:relative; left:0px">
                                <option value="Выбрать из списка" selected>Выбрать из списка</option>
                                <option value="Фиксированная"> Фиксированная</option>
                                <option value="Минимальная"> Минимальная</option>
                                <option value="По результатам собеседования"> По результатам собеседования</option>
                            </select>
                        </div>
                        <div>Наличие соцпакета </div>
                        <div>   <input type="checkbox" name="Vac_SocPack" id="Vac_SocPack" value="" style="width:50px" /> </div>
                    </form>
                </div>

                <div class="outer">
                    <a href="javascript:Empl_f1('frm2_1')" class="innerTitle">
                        <span id="frm2_1_" class="innerTitle_">▷</span>&nbsp;&nbsp; Требования к соискателю
                    </a>              <br>
                    <form class="gr hide" id="frm2_1">
                        <div></div>              <div><i>Профессиональные</i></div>
                        <div>   Специализация (Профессиональный стандарт)</div>
                        <div>
                            <textarea rows="5" name="Vac_JobBase" id="Vac_JobBase" value=" "
                                      onclick="GetMultValue( )"></textarea>*
                            <br> <select id="sel6_vac" name="sel6_vac" class="hide opt1"
                                         style="position:relative; left:0px;">
                            </select>
                        </div>

                        <div>Уровень работы с ПК </div>
                        <div>
                            <input type="text" name="Vac_PC_Skill" id="Vac_PC_Skill" value=" " onclick="GetVacValue('sel5_vac',  'Vac_PC_Skill')" />*
                            <br> <select id="sel5_vac" name="sel5_vac" class="hide opt1" style="position:relative; left:0px">
                                <option value="Выбрать из списка" selected>Выбрать из списка</option>
                                <option value="Не требуется">Не требуется</option>
                                <option value="Слабый уровень">Слабый уровень</option>
                                <option value="Средний уровень">Средний уровень</option>
                                <option value="Уверенное владение">Уверенное владение</option>
                            </select>
                        </div>
                        <!--div>Владение специали-зированным ПО</div><div>   <textarea rows="2" name="Vac_Soft" id="Vac_Soft"> </textarea>       </div>
                -->

                        <div>Дополнительные требования</div>
                        <div>   <textarea rows="3" name="Vac_AddSkill" id="Vac_AddSkill"> </textarea>       </div>

                        <div>Необходимые дело- <br>вые и личностные качества соискателя</div>
                        <div>
                                <div style="display: grid; grid-template-columns: 50px auto; font:400 1.0em calibri; color: #345">
                                <div><input type="checkbox" name="Vac_q1" id="Vac_q1" value="1"> </div>
                                <div id="q1_">Обучаемость    </div>
                                <div><input type="checkbox" name="Vac_q2" id="Vac_q2" value="2"> </div>
                                <div id="q2_">Адаптация к информационным системам    </div>
                                <div><input type="checkbox" name="Vac_q3" id="Vac_q3" value="3"> </div>
                                <div id="q3_">Умение работать с большим количеством информации    </div>
                                <div><input type="checkbox" name="Vac_q4" id="Vac_q4" value="4"> </div>
                                <div id="q4_">Умение работать в команде    </div>
                                <div><input type="checkbox" name="Vac_q5" id="Vac_q5" value="5"> </div>
                                <div id="q5_">Инициативность   </div>
                                <div><input type="checkbox" name="Vac_q6" id="Vac_q6" value="6"> </div>
                                <div id="q6_">Стремление к повышению профессионального уровня </div>
                                <div><input type="checkbox" name="Vac_q7" id="Vac_q7" value="7"> </div>
                                <div id="q7_">Исполнительность, ответственность </div>
                                <div><input type="checkbox" name="Vac_q8" id="Vac_q8" value="8"> </div>
                                <div id="q8_">Самостоятельность    </div>
                                <div><input type="checkbox" name="Vac_q9" id="Vac_q9" value="9"> </div>
                                <div id="q9_">Коммуникабельность,  уравновешенность, вежливость   </div>

                            </div>
                        </div>
                    </form>
                </div>
                <div class="outer">
                    <a href="javascript:Empl_f1('frm3_1')" class="innerTitle">
                        <span id="frm3_1_" class="innerTitle_">▷</span>&nbsp;&nbsp; Даты создания и последней редакции
                    </a>              <br>
                    <form class="gr hide" id="frm3_1">
                        <div></div>
                        <div>
                            <input type="date" class="shortDate" name="Vac_Date5" id="Vac_Date5" disabled />  &nbsp;-&nbsp;
                            <input type="date" class="shortDate" name="Vac_Date6" id="Vac_Date6" disabled />
                        </div>
                    </form>
                </div>

            </div>
            <div class="outer1">
                <a href="javascript: SaveVacancy()" style="padding-left:70px">  Сохранить данные   </a>
            </div>

            <article style="display:none__">
                <span id="id_vac__"   style="display:none">  {{VAC}} </span>   <span id="id_bd_vac" > {{VAC_ID_BD}} </span>
            </article>
        </div>
        
        <div>
            <span class="Title">
                Справка по созданию вакансии
            </span><br>
            <a href="javascript:f1('Vac_pp1')" class="innerTitle">
                <span id="Vac_pp1_" class="innerTitle">◤</span>&nbsp;&nbsp; Показать / скрыть
            </a>
            <div class="note_border">
                <div id="pp1" style="width:98%">текст справки</div>
            </div>
        </div>
    </div>

    <script>
        var jobList_Options = null;
            function GetVacValue(id_sel, id_elem) {                                    // выбор эл-та из указанного списка, эл-т списка   --> эл-т   с   id_elem
            var sel = document.querySelector('#' + id_sel);
            sel.classList.remove('hide');                                                       // отображение списка
            sel.addEventListener('change', function (e) {
                var code = e.target.value;
                sel_index = sel.selectedIndex;                                                     // индекс выбранного эл-та  списка select
                sel.classList.add("hide");                                                              //сокрытие select
                document.querySelector('#' + id_elem).value = code;              // элемент списка ->  в поле с  id_elem
                                                                                                                         // дополнительная обработка отдельных случаев  
                if (id_sel === 'sel1_vac')     { CreateJobListOptions(code);    return; }
                if (id_sel === 'sel4_vac')     { CheckSalaryType(sel_index);    return; }         
                //   if (id_sel === 'sel5_vac')     { SetVacPC(sel_index);                return; }
            });
        }
        function CheckSalaryType(sel_index) {                                                // выбор типа зарплаты. Если 'по' результатм собеседования'
            var obj = document.querySelector('#Vac_Salary_1');                    // то размер не указывается 
            if (sel_index === 3) { obj.setAttribute("disabled", "disabled"); obj.value = ""; return; }
            obj.removeAttribute("disabled");
        }
    
        async function ReadJobList(code)
        {  var d2 = (code.trim()).substring(0, 2);                                              // d2 - код по реестру Минтруда    -  alert('/' + d2 + '/');
            var response = await fetch('/TEXT/JobLists/' + d2 + '.txt');            //   ожидание загрузки файла TEXT/JobLists/КОД.txt
            var text = await response.text();        
            return text;
        }
        var options = null;
        var sel6 = null;
        var sel6_index = 0;
      
        function CreateJobListOptions(code)                                    // Вызывается при выборе параметра  Код (по реестру МинТруда)
        {  ReadJobList(code).then((data) =>                                      // Для выбранного када надо загрузить список специальностей
             {    var lines = data.split(['\n']);                                        //  alert("  lines = " + lines.length);
                  var N = lines.length;                                                     // число строк в файле    TEXT/JobLists/КОД.txt.     
                  options = "<option value='Выбрать из списка' selected> Можно выбрать несколько значений из списка</option>";
                 for (var i = 0; i < N; i++)                                                   // формирование списка (специальнстей)  
                           {  var line = lines[i].replace(/\s+/g, ' ');
                               options += "<option value='" + line + "'>" + line + "</option>";          console.log(options);   
                           }    
                 sel6 = document.querySelector('#sel6_vac');             // вставка сформированного списка в документ
                 sel6.innerHTML = options;
                 var receiver = document.querySelector('#Vac_JobBase');                                    // куда поместить результат выбора
                 sel6.addEventListener('blur',       () =>  {  sel6.classList.add("hide");    });           // скрыть список при потере фокуса
                 sel6.addEventListener('change',  function (e) {    var code = e.target.value;       // обработка события change
                                                                                                    receiver.value += code + "\n";     
                                                                                                    sel6_index++;                           console.log("code=" + code); 
                                                                                                    receiver.click();
                                                                        });
                       });
        }
   function GetMultValue()
   {     if (sel6 !=null)        sel6.classList.remove('hide');                     // Если имеется список специальностей, открыть его.                                      
   }
   //------------------------------------сохранение вакансии--------------------------------------------------------------------------
    async function SaveVacancy()
    {   var vac_data = "";
        for (var i = 1; i < 4; i++) {
            var frm = new FormData(document.getElementById ( 'frm'+ i + '_1' ) );
            for (let [key, value] of frm) {
                if (key.includes("Vac_")) vac_data += key + "▷" + value + "◤" + "\n";
            }
        }
        //alert("vac_data=\n" + vac_data);
        document.getElementById("Vac_Date6").valueAsDate = new Date();
        var object__ = {};
        object__["empl_id"] = document.getElementById("header3_ind").innerText;
        object__["id_bd_vac"] = document.getElementById("id_bd_vac").innerText;
        object__["vac_data"] = vac_data;
                                                                                              // добавить поле из анкеты mpl_AuxInfo - информация о предприятии, 

        var json__ = JSON.stringify(object__);                      //  преобразование в json объект     
        var res0 = "";   //"Передача данных на сервер. Размер данных = " + vac_data.length + "\n";
        let response__ = await fetch('/empl_vacancy_data', {     method: 'POST',
                                                                                                        headers: { "Content-Type": "application/json; charset=UTF-8" },
                                                                                                         body: json__
                                                                                             });
        let result = await response__.text();
        MyCustomAlert(res0 + result);
    }

            //-------------------Прочитать текст справки-----------------------------------------------------------------------------
        async function Vac_NodeText() {
            var response = await fetch('/TEXT/emplVacNote.txt');
            var text = await response.text();                                                       //console.log(text);
            return text;
        }

        function ShowGraphOfWork()
        {    document.getElementById("GraphOfWorkInfo").classList.toggle('hide');
        }
        //-------------------Прочитать области деятельности  /TEXT/00.txt, сформировать options  ->select----------------------------------
        async function ReadList_00() {
            var response = await fetch('/TEXT/JobLists/00.txt');
            var text = await response.text();
            return text;
        }
        function Create_sel1()
        {  ReadList_00().then( (data) => {
                    var lines = data.split(['\n']);                                                                              //      alert("  lines = " + lines.length);
                     var N = lines.length;
                     options = "<option value='Выбрать из списка' selected>Выбрать из списка</option>";
                     for (var i = 0; i < N; i++) {
                         options += "<option value='" + lines[i] + "' >" + lines[i] + "</option>";        //console.log(options);   
                                                                }
                    document.querySelector("#sel1_vac").innerHTML = options;
                                                                                });
        }

        //- ---------------------------------------Заполнение вакансии ---------------------------------  //▷◤//---------------
    function FillVac()
        {  var cur_num = (document.getElementById ("id_vac_cur").innerHTML).trim();                  // номер вакансии 
           var all_vac = document.getElementById ("header3_all_vac").innerHTML;               //  всего вакансий 
           all_vac = (all_vac.replace("Число вакансий ","")) .trim();                                            //  alert (Number( cur_num ) +"   " +  Number(all_vac));
             if (Number( cur_num )> Number(all_vac) )                                                                  //  создание новой вакансии   
             {   document.getElementById("doc_title").innerText = "Создание новой вакансии";
                 document.getElementById("Vac_Date5").valueAsDate = new Date();                 // остальные поля пустые
                 document.getElementById("Vac_Date6").valueAsDate = new Date();      
                 document.getElementById("id_bd_vac").innerHTML= "-1";
                 return;
             }
             document.getElementById("doc_title").innerText = "Редактирование  вакансии";     
             var vac= document.getElementById ("id_vac__").innerHTML;                              // alert (vac);     
            var str =  vac.split('◤');
            var  N= str.length;
            for (var i=0; i<N-1; i++)
            {   var elem = str[i].split('▷');
                var id_elem = elem[0].trim();  
                var val = elem[1];                                                                                                      // console.log (  "'" + id_elem +  "'  -  "  + val );
                var tagName = document.getElementById(id_elem).tagName;
                var typeCheckbox = false;                 
                 if (tagName == "INPUT") {    typeCheckbox = document.getElementById(id_elem).getAttribute('type') == 'checkbox';
                                                                 if (typeCheckbox == true) document.getElementById(id_elem).checked = true;
                                                                  else document.getElementById(id_elem).value = val;            }
                 else document.getElementById(id_elem).innerHTML = val;
            }
            document.getElementById("Vac_Date6").valueAsDate = new Date();      
        }
    
        function  ClearVac()                                                                         // очистить поля формы  вакансии
        {  var elems = document.querySelectorAll('input'); 
           var N= elems.length;
           for (var i=0; i<N; i++)  
           {    var typeCheckbox = false;     
               typeCheckbox = elems[i].getAttribute('type') == 'checkbox';
                if (typeCheckbox == true)  elems[i].checked = false;
                else   elems[i].value="";
              }
              elems = document.querySelectorAll('textarea');
              for (var i=0; i<elems.length; i++)  elems[i].value="";
        }
        
        function f_back()                                                                                                                                       // листание назад
        {   var cur_num = Number((document.getElementById("id_vac_cur").innerHTML).trim());            // номер вакансии 
            if (cur_num == 1) return;
            cur_num--; 
            var id_empl = (document.getElementById("header3_ind").innerHTML).trim();
            var query = "/empl_next_vacancy?" + id_empl + "&" + cur_num;                                                    //   alert (query); 
            document.getElementById("id_vac_cur").innerHTML = cur_num;
            document.getElementById("next_vacancy_Empl").click();
        }
       function f_forward()                                                                                                                                      // листание вперед
        {    var cur_num = Number ( (document.getElementById ("id_vac_cur").innerHTML).trim() );            // номер вакансии 
              var all_vac = document.getElementById ("header3_all_vac").innerHTML;                                      //  всего вакансий 
              all_vac = Number (  (all_vac.replace("Число вакансий ","")) .trim() );                         
              cur_num++;                                                                                                                                           //   console.log (   cur_num +  "  -  "  + all_vac );
              if ( cur_num > all_vac )                                                                                                                          //  создание новой вакансии   
              {   ClearVac()  ;
                  cur_num = all_vac+1;
                  document.getElementById("doc_title").innerText = "Создание новой вакансии";
                  document.getElementById ("id_vac_cur").innerHTML=cur_num;
                 document.getElementById("Vac_Date5").valueAsDate = new Date();                 // остальные поля пустые
                 document.getElementById("Vac_Date6").valueAsDate = new Date();      
                 document.getElementById("id_bd_vac").innerHTML= "-1";
              }
              else                                                                                                                                                          // запрос следующей вакансии
              {   var id_empl= (document.getElementById("header3_ind").innerHTML).trim();
                  var query = "/empl_next_vacancy?"+ id_empl+ "&"+cur_num;                                                //   alert (query); 
                   document.getElementById ("id_vac_cur").innerHTML = cur_num;
                   document.getElementById ("next_vacancy_Empl").click();
              }
        }

        //-----------------------------------------Действия при загрузке страницы------------------------------------------------
                                                                           // показать справку   
        Vac_NodeText().then( (data) => {
                       document.querySelector("#pp1").innerHTML = data;
                       Create_sel1();
                                                                })
        FillVac();
  //-----------------------------------------------------------------------------------------
    </script>

